#!/bin/bash

echo "üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –°–ï–†–í–ï–†–ê"
echo "=================================="

echo "1. –£–±–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–∞ –ø–æ—Ä—Ç—É 3001..."
node kill-port-3001.js

echo ""
echo "2. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º..."
node diagnose-server-issues.js

echo ""
echo "3. –¢–µ—Å—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞..."
echo "–ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤–∞—Ä–∏–π–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –Ω–∞ 10 —Å–µ–∫—É–Ω–¥..."
timeout 10s node emergency-server.js &
EMERGENCY_PID=$!

# –ñ–¥–µ–º 2 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞
sleep 2

echo ""
echo "4. –¢–µ—Å—Ç–∏—Ä—É–µ–º –∞–≤–∞—Ä–∏–π–Ω—ã–π —Å–µ—Ä–≤–µ—Ä..."
curl -s http://localhost:3001/api/health || echo "‚ùå –ê–≤–∞—Ä–∏–π–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç"

echo ""
echo "5. –ü—Ä–æ–±—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä..."
echo "–í—ã–ø–æ–ª–Ω—è–µ–º: cd server && npx tsx src/simple-app.ts"

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤–∞—Ä–∏–π–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
kill $EMERGENCY_PID 2>/dev/null

# –ü—Ä–æ–±—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
cd server
timeout 10s npx tsx src/simple-app.ts

echo ""
echo "=================================="
echo "–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê"